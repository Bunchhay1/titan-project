# ==========================================
# ? TITAN CORE - LOCAL ENVIRONMENT (INTELLIJ)
# ==========================================

# 1. ?? DATABASE CONNECTION
# Connects to 'titan-db-prod' container on port 5432
spring.datasource.url=jdbc:postgresql://localhost:5432/titandb
spring.datasource.username=postgres
spring.datasource.password=TitanDB$ecure2026_X9z!Lp
# 6. SECURITY (JWT) - Updated with new Base64 Key
app.jwt.secret=5367566B59703373367639792F423F4528482B4D6251655468576D5A71347437
spring.datasource.driver-class-name=org.postgresql.Driver

# 2. ? DATABASE MIGRATION (Flyway)
# ?? Disable Flyway for now to avoid conflicts with Hibernate auto-generation
spring.flyway.enabled=false
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration

# 3. ?? JPA / HIBERNATE (THE FIXER)
# ? 'create-drop' will wipe the DB on startup.
# This fixes the "Ghost Enum" and "Schema Mismatch" issues instantly.
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# 4. ? REDIS CACHE
# Connects to 'titan-redis-prod' container on port 6379
spring.data.redis.host=localhost
spring.data.redis.port=6379

# 5. ? AI RISK ENGINE (gRPC)
# Connects to 'titan-ai' container on port 50051
titan.ai.host=localhost
titan.ai.port=50051
grpc.client.riskEngineClient.address=static://localhost:50051
grpc.client.riskEngineClient.negotiationType=PLAINTEXT


app.jwt.expiration-ms=86400000

server.port=8080

# ? RESILIENCE4J (CIRCUIT BREAKER)
# Protects the app if the Python AI service goes down
resilience4j.circuitbreaker.instances.risk-engine.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.risk-engine.wait-duration-in-open-state=5s
resilience4j.circuitbreaker.instances.risk-engine.sliding-window-size=10

# ? OBSERVABILITY (Zipkin Tracing)
# Connects to 'titan-zipkin' container on port 9411
management.tracing.sampling.probability=1.0
management.zipkin.tracing.endpoint=http://localhost:9411/api/v2/spans

# ? LOGGING PATTERN
logging.pattern.level=%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]
spring.application.name=titan-core-banking

# ?? SPRING BATCH
# Ensures Batch tables are created automatically
spring.batch.jdbc.initialize-schema=always
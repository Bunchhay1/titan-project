version: '3.8'

services:
  # üß† Python AI Service
  titan-ai:
    image: titan-ai
    build: ./titan-ai-service
    container_name: titan-ai
    ports:
      - "50051:50051" # Maps to localhost:50051
    networks:
      - titan-network
    restart: on-failure

  # üóÑÔ∏è Database (PostgreSQL)
  postgres-db:
    image: postgres:15-alpine
    container_name: titan-db-prod
    environment:
      - POSTGRES_USER=postgres
      # ‚úÖ MATCHES YOUR CONFIG: spring.datasource.password=mysecretpassword
      - POSTGRES_PASSWORD=TitanDB$ecure2026_X9z!Lp
      # ‚úÖ MATCHES YOUR CONFIG: spring.datasource.url=.../titandb
      - POSTGRES_DB=titandb 
    ports:
      - "5432:5432" # Maps to localhost:5432
    volumes:
      - titan_db_data:/var/lib/postgresql/data
    networks:
      - titan-network
    restart: always

  # ‚ö° Redis Cache
  redis-cache:
    image: redis:alpine
    container_name: titan-redis-prod
    ports:
      - "6379:6379" # Maps to localhost:6379
    networks:
      - titan-network
    restart: always

  # üïµÔ∏è Zipkin (Tracing)
  zipkin:
    image: openzipkin/zipkin
    container_name: titan-zipkin
    ports:
      - "9411:9411"
    networks:
      - titan-network

networks:
  titan-network:
    driver: bridge

volumes:
  titan_db_data: